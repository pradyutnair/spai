#!/bin/bash
#SBATCH --partition=cbuild
#SBATCH --cpus-per-task=16
#SBATCH --job-name=download
#SBATCH --output=job_outputs/download_dataset_ld.out
#SBATCH --error=job_outputs/download_dataset_ld.err
#SBATCH --time=6:00:00

echo "âœ… Job started: $(date)"

# Create target directory
echo "ğŸ“ Creating target directory..."
mkdir -p /scratch-shared/dl2_spai

# Change to working directory
cd /scratch-shared/dl2_spai
echo "ğŸ“ Changed to working directory: $(pwd)"

# # Download all 7z parts
# echo "â¬‡ï¸ Starting download of ProGAN multi-part archives..."
# wget https://huggingface.co/datasets/sywang/CNNDetection/resolve/main/progan_train.7z.001 &
# wget https://huggingface.co/datasets/sywang/CNNDetection/resolve/main/progan_train.7z.002 &
# wget https://huggingface.co/datasets/sywang/CNNDetection/resolve/main/progan_train.7z.003 &
# wget https://huggingface.co/datasets/sywang/CNNDetection/resolve/main/progan_train.7z.004 &
# wget https://huggingface.co/datasets/sywang/CNNDetection/resolve/main/progan_train.7z.005 &
# wget https://huggingface.co/datasets/sywang/CNNDetection/resolve/main/progan_train.7z.006 &
# wget https://huggingface.co/datasets/sywang/CNNDetection/resolve/main/progan_train.7z.007 &

# # Wait for all background downloads
# wait $(jobs -p)
# echo "âœ… All .7z part files downloaded."

# # Extract 7z archive
# echo "ğŸ“¦ Extracting 7z archive..."
# ./7zz x progan_train.7z.001
# rm progan_train.7z.*
# echo "ğŸ§¹ Removed .7z part files."

# # Unzip the extracted archive
# echo "ğŸ—‚ï¸ Unzipping progan_train.zip..."
# unzip progan_train.zip
# rm progan_train.zip
# echo "ğŸ§¹ Removed progan_train.zip."

# # Download and extract CNN_synth_testset
# echo "â¬‡ï¸ Downloading CNN_synth_testset.zip..."
# wget https://huggingface.co/datasets/sywang/CNNDetection/resolve/main/CNN_synth_testset.zip

# echo "ğŸ—‚ï¸ Unzipping CNN_synth_testset.zip..."
# unzip CNN_synth_testset.zip
# rm CNN_synth_testset.zip
# echo "ğŸ§¹ Removed CNN_synth_testset.zip."

## Download and extract latent_diffusion_trainingset
#echo "â¬‡ï¸ Downloading latent_diffusion_trainingset.zip..."
#wget https://www.grip.unina.it/download/prog/DMimageDetection/latent_diffusion_trainingset.zip

echo "ğŸ—‚ï¸ Creating folder and unzipping latent_diffusion_trainingset.zip..."
mkdir -p /scratch-shared/dl2_spai/datasets/
unzip -n latent_diffusion_trainingset.zip -d /scratch-shared/dl2_spai/datasets/ | tee unzip_resume.log
#rm latent_diffusion_trainingset.zip
#echo "ğŸ§¹ Removed latent_diffusion_trainingset.zip."

echo "âœ… Job completed: $(date)"
